<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Manager Setup &mdash; QCFractal 0+untagged.1.g522c5ba documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Results" href="results.html" />
    <link rel="prev" title="Server Setup" href="setup_server.html" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> QCFractal
          </a>
              <div class="version">
                0+untagged.1.g522c5ba
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Install QCFractal</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup_quickstart.html">Setup Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup_server.html">Server Setup</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Manager Setup</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#distributed-workflow-engines">Distributed Workflow Engines</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-the-command-line">Using the Command Line</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-the-python-api">Using the Python API</a></li>
<li class="toctree-l2"><a class="reference internal" href="#testing">Testing</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Records Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="results.html">Results</a></li>
<li class="toctree-l1"><a class="reference internal" href="procedures.html">Procedures</a></li>
<li class="toctree-l1"><a class="reference internal" href="services.html">Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="flow.html">Fractal Call Flowcharts</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Manager Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="managers.html">Fractal Queue Managers</a></li>
<li class="toctree-l1"><a class="reference internal" href="managers_config_api.html">Queue Manager API</a></li>
<li class="toctree-l1"><a class="reference internal" href="managers_hpc.html">Configuration for High-Performance Computing</a></li>
<li class="toctree-l1"><a class="reference internal" href="managers_samples.html">Queue Manager Example YAML Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="managers_faq.html">Queue Manager Frequent Questions and Issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="managers_detailed.html">Detailed Manager Information</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Server CLI and Configuration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="server_init.html">Fractal Server Init</a></li>
<li class="toctree-l1"><a class="reference internal" href="server_config.html">Fractal Server Config</a></li>
<li class="toctree-l1"><a class="reference internal" href="server_start.html">Fractal Server Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="server_user.html">Fractal Server User</a></li>
<li class="toctree-l1"><a class="reference internal" href="server_upgrade.html">Fractal Server Upgrade</a></li>
<li class="toctree-l1"><a class="reference internal" href="server_view.html">Server-side Dataset Views</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="qcarchive_overview.html">QCArchive Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">QCFractal API</a></li>
<li class="toctree-l1"><a class="reference internal" href="database_design.html">Database Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev_guidelines.html">Development Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">QCFractal</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Manager Setup</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/setup_compute.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="manager-setup">
<h1>Manager Setup<a class="headerlink" href="#manager-setup" title="Permalink to this headline"></a></h1>
<p>Once a QCFractal server is running, compute can be attached to it by spinning
up <code class="docutils literal notranslate"><span class="pre">qcfractal-manager</span></code>. These <code class="docutils literal notranslate"><span class="pre">qcfractal-manager</span></code> connect to your
FractalServer instance, adds tasks to a distributed workflow manager, and
pushes complete tasks back to the <code class="docutils literal notranslate"><span class="pre">qcfractal-server</span></code> instance. These
<code class="docutils literal notranslate"><span class="pre">qcfractal-manager</span></code> should be run on either the machine that is executing
the computations or on the head nodes of supercomputers and local clusters.</p>
<section id="distributed-workflow-engines">
<h2>Distributed Workflow Engines<a class="headerlink" href="#distributed-workflow-engines" title="Permalink to this headline"></a></h2>
<p>QCFractal supports a number of distributed workflow engines to execute
computations. Each of these has strengths and weaknesses depending on the
workload, task specifications, and resources that the compute will be executed
on. In general, we recommend the following:</p>
<ul class="simple">
<li><p>For laptops and single nodes: ProcessPoolExecutor</p></li>
<li><p>For local clusters: Dask or Parsl</p></li>
</ul>
<p>The ProcessPoolExecutor uses built-in Python types and requires no additional
libraries while Dask requires <code class="docutils literal notranslate"><span class="pre">dask</span></code>, <code class="docutils literal notranslate"><span class="pre">dask.distributed</span></code>, and
<code class="docutils literal notranslate"><span class="pre">dask_jobqueue</span></code> (<a class="reference external" href="http://distributed.dask.org/en/latest/">Dask Distributed Docs</a>, <a class="reference external" href="https://jobqueue.dask.org/en/latest/">Dask Jobqueue Docs</a>); and Parsl requires <code class="docutils literal notranslate"><span class="pre">parsl</span></code> (<a class="reference external" href="https://parsl.readthedocs.io/en/latest/index.html">Parsl Docs</a>)</p>
</section>
<section id="using-the-command-line">
<h2>Using the Command Line<a class="headerlink" href="#using-the-command-line" title="Permalink to this headline"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The CLI + YAML config file is the current recommended way to start and run
Fractal Queue Managers</p>
</div>
<p>At the moment only ProcessPoolExecutor <code class="docutils literal notranslate"><span class="pre">qcfractal-manager</span></code> can be spun up purely
from the command line as other distributed workflow managers require
additional setup through a YAML config file.</p>
<p>For the full docs for setting up a <a class="reference internal" href="managers.html#term-Manager"><span class="xref std std-term">Manager</span></a>, please see <a class="reference internal" href="managers.html"><span class="doc">the Manager documentation pages.</span></a></p>
<p>Launching a <code class="docutils literal notranslate"><span class="pre">qcfractal-manager</span></code> using a ProcessPoolExecutor:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>fractal-manager executor
<span class="go">[I 190301 10:45:50 managers:118] QueueManager:</span>
<span class="go">[I 190301 10:45:50 managers:119]     Version:         v0.5.0</span>

<span class="go">[I 190301 10:45:50 managers:122]     Name Information:</span>
<span class="go">[I 190301 10:45:50 managers:123]         Cluster:     unknown</span>
<span class="go">[I 190301 10:45:50 managers:124]         Hostname:    qcfractal.local</span>
<span class="go">[I 190301 10:45:50 managers:125]         UUID:        0d2b7704-6ac0-4ef7-b831-00aa6afa8c1c</span>

<span class="go">[I 190301 10:45:50 managers:127]     Queue Adapter:</span>
<span class="go">[I 190301 10:45:50 managers:128]         &lt;ExecutorAdapter client=&lt;ProcessPoolExecutor max_workers=8&gt;&gt;</span>

<span class="go">[I 190301 10:45:50 managers:131]     QCEngine:</span>
<span class="go">[I 190301 10:45:50 managers:132]         Version:    v0.6.1</span>

<span class="go">[I 190301 10:45:50 managers:150]     Connected:</span>
<span class="go">[I 190301 10:45:50 managers:151]         Version:     v0.5.0</span>
<span class="go">[I 190301 10:45:50 managers:152]         Address:     https://localhost:7777/</span>
<span class="go">[I 190301 10:45:50 managers:153]         Name:        QCFractal Server</span>
<span class="go">[I 190301 10:45:50 managers:154]         Queue tag:   None</span>
<span class="go">[I 190301 10:45:50 managers:155]         Username:    None</span>

<span class="go">[I 190301 10:45:50 managers:194] QueueManager successfully started. Starting IOLoop.</span>
</pre></div>
</div>
<p>The connected <code class="docutils literal notranslate"><span class="pre">qcfractal-server</span></code> instance can be controlled by:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>qcfractal-manager --fractal-uri<span class="o">=</span>api.qcfractal.molssi.org:443
</pre></div>
</div>
<p>Only basic settings can be started through the CLI and most of the options require a YAML config file to get up and
going. You can check all valid YAML options in <a class="reference internal" href="managers.html"><span class="doc">the Manager documentation pages</span></a> or you can always
check the current schema from the CLI with:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>qcfractal-manager --schema
</pre></div>
</div>
<p>The CLI has several options which can examined with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qcfractal</span><span class="o">-</span><span class="n">manager</span> <span class="o">--</span><span class="n">help</span>
</pre></div>
</div>
<p>Every option specified in the CLI has an equal option in the YAML config file (except for <code class="docutils literal notranslate"><span class="pre">--help</span></code> and <code class="docutils literal notranslate"><span class="pre">--schema</span></code>),
but many YAML options are not present in the CLI due to their complex nature. Any option set in both places will
defer to the CLI’s setting, allowing you to overwrite some of the common YAML config options on invocation.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">--manager-name</span></code> argument is useful to change the name of the manager
reported back to the <a class="reference internal" href="managers.html#term-Server"><span class="xref std std-term">Server</span></a> instance. In addition, the
<code class="docutils literal notranslate"><span class="pre">--queue-tag</span></code> will limit the acquisition of tasks to only the desired
<a class="reference internal" href="managers.html#term-Server"><span class="xref std std-term">Server</span></a> task tags. These settings can also all be set in the YAML
config file.</p>
</div>
</section>
<section id="using-the-python-api">
<h2>Using the Python API<a class="headerlink" href="#using-the-python-api" title="Permalink to this headline"></a></h2>
<p><code class="docutils literal notranslate"><span class="pre">qcfractal-managers</span></code> can also be created using the Python API.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This is for advanced users and special care needs to be taken to ensure
that both the manager and the workflow tool need to understand the number
of cores and memory available to prevent over-subscription of compute.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">qcfractal.interface</span> <span class="kn">import</span> <span class="n">FractalClient</span>
<span class="kn">from</span> <span class="nn">qcfractal</span> <span class="kn">import</span> <span class="n">QueueManager</span>

<span class="kn">import</span> <span class="nn">dask</span> <span class="kn">import</span> <span class="nn">distributed</span>

<span class="n">fractal_client</span> <span class="o">=</span> <span class="n">FractalClient</span><span class="p">(</span><span class="s2">&quot;localhost:7777&quot;</span><span class="p">)</span>
<span class="n">workflow_client</span> <span class="o">=</span> <span class="n">distributed</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="s2">&quot;tcp://10.0.1.40:8786&quot;</span><span class="p">)</span>

<span class="n">ncores</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">mem</span> <span class="o">=</span> <span class="mi">2</span>

<span class="c1"># Build a manager</span>
<span class="n">manager</span> <span class="o">=</span> <span class="n">QueueManager</span><span class="p">(</span><span class="n">fractal_client</span><span class="p">,</span> <span class="n">workflow_client</span><span class="p">,</span> <span class="n">cores_per_task</span><span class="o">=</span><span class="n">ncores</span><span class="p">,</span> <span class="n">memory_per_task</span><span class="o">=</span><span class="n">mem</span><span class="p">)</span>

<span class="c1"># Important for a calm shutdown</span>
<span class="kn">from</span> <span class="nn">qcfractal.cli.cli_utils</span> <span class="kn">import</span> <span class="n">install_signal_handlers</span>
<span class="n">install_signal_handlers</span><span class="p">(</span><span class="n">manager</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="n">manager</span><span class="o">.</span><span class="n">stop</span><span class="p">)</span>

<span class="c1"># Start or test the loop. Swap with the .test() and .start() method respectively</span>
<span class="n">manager</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="testing">
<h2>Testing<a class="headerlink" href="#testing" title="Permalink to this headline"></a></h2>
<p>A <code class="docutils literal notranslate"><span class="pre">qcfractal-manager</span></code> can be tested using the <code class="docutils literal notranslate"><span class="pre">--test</span></code> argument and does
not require an active <code class="docutils literal notranslate"><span class="pre">qcfractal-manager</span></code>, this is very useful to check if
both the distributed workflow manager is setup correctly and correct
computational engines are found.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>qcfractal-manager --test
<span class="go">[I 190301 10:55:57 managers:118] QueueManager:</span>
<span class="go">[I 190301 10:55:57 managers:119]     Version:         v0.5.0+52.g6eab46f</span>

<span class="go">[I 190301 10:55:57 managers:122]     Name Information:</span>
<span class="go">[I 190301 10:55:57 managers:123]         Cluster:     unknown</span>
<span class="go">[I 190301 10:55:57 managers:124]         Hostname:    Daniels-MacBook-Pro.local</span>
<span class="go">[I 190301 10:55:57 managers:125]         UUID:        0cd257a6-c839-4743-bb33-fa55bebac1e1</span>

<span class="go">[I 190301 10:55:57 managers:127]     Queue Adapter:</span>
<span class="go">[I 190301 10:55:57 managers:128]         &lt;ExecutorAdapter client=&lt;ProcessPoolExecutor max_workers=8&gt;&gt;</span>

<span class="go">[I 190301 10:55:57 managers:131]     QCEngine:</span>
<span class="go">[I 190301 10:55:57 managers:132]         Version:    v0.6.1</span>

<span class="go">[I 190301 10:55:57 managers:158]     QCFractal server information:</span>
<span class="go">[I 190301 10:55:57 managers:159]         Not connected, some actions will not be available</span>
<span class="go">[I 190301 10:55:57 managers:389] Testing requested, generating tasks</span>
<span class="go">[I 190301 10:55:57 managers:425] Found program rdkit, adding to testing queue.</span>
<span class="go">[I 190301 10:55:57 managers:425] Found program torchani, adding to testing queue.</span>
<span class="go">[I 190301 10:55:57 managers:425] Found program psi4, adding to testing queue.</span>
<span class="go">[I 190301 10:55:57 base_adapter:124] Adapter: Task submitted rdkit</span>
<span class="go">[I 190301 10:55:57 base_adapter:124] Adapter: Task submitted torchani</span>
<span class="go">[I 190301 10:55:57 base_adapter:124] Adapter: Task submitted psi4</span>
<span class="go">[I 190301 10:55:57 managers:440] Testing tasks submitting, awaiting results.</span>

<span class="go">[I 190301 10:56:04 managers:444] Testing results acquired.</span>
<span class="go">[I 190301 10:56:04 managers:451] All tasks retrieved successfully.</span>
<span class="go">[I 190301 10:56:04 managers:456]   rdkit - PASSED</span>
<span class="go">[I 190301 10:56:04 managers:456]   torchani - PASSED</span>
<span class="go">[I 190301 10:56:04 managers:456]   psi4 - PASSED</span>
<span class="go">[I 190301 10:56:04 managers:465] All tasks completed successfully!</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="setup_server.html" class="btn btn-neutral float-left" title="Server Setup" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="results.html" class="btn btn-neutral float-right" title="Results" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018-2021, The Molecular Sciences Software Institute.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>